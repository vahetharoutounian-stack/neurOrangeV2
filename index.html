<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>neurOrange ‚Äî CCW emoji rings, comet, upright paintings</title>
<style>
  :root{
    --quin:#ED6A00; --pure:#FFA500; --bergamot:#FFA64D; --nick:#FF6600;
    --gap-deg: 3deg;                  /* swatch separator width (deg) */
    --inner-thick: 34px;              /* px (runtime) */
    --outer-thick-mult: 2.2;          /* outer thickness = inner * mult */
    --mid-move-duration: 2200ms;
    --emoji-font: 18px;               /* px (set from screen width) */
    --scene-glow: 0 0 10px #000, 0 0 18px #000;   /* soft global glow */
  }

  *{box-sizing:border-box}
  html,body{
    margin:0; height:100%; background:#000; color:#fff;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    -webkit-font-smoothing: antialiased; overflow:hidden;
  }

  /* Full-bleed canvas; we also compute exact px layout in JS */
  #phone{ position:fixed; inset:0; width:100dvw; height:100dvh; display:grid; place-items:center; background:#000; }
  #canvas{ position:relative; width:100%; height:100%; overflow:hidden; background:#000; }

  /* Layering (ascending z): 1 bg, 2 inner, 2.5 comet, 3 outer, 4 emoji rings, 5 question, 6 brand, 8 paintings, 10 outro */
  #brandBar{
    position:absolute; left:env(safe-area-inset-left); right:env(safe-area-inset-right);
    top:calc(env(safe-area-inset-top) + 10px);
    display:flex; justify-content:center; z-index:6;
    filter: drop-shadow(var(--scene-glow));
  }
  #brand{ font-weight:900; letter-spacing:.12em; font-size:clamp(18px,5vw,32px); color:var(--pure) }

  #bgLayer{ position:absolute; inset:0; z-index:1; opacity:1; }
  #bgVideo{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; background:#000; }
  #tapToPlay{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    z-index:2; color:#fff; background:rgba(0,0,0,.42);
    padding:.4rem .6rem; border-radius:.6rem; font-size:clamp(12px,3.5vw,14px);
    backdrop-filter: blur(4px); display:none;
  }
  .fogWrap{
    position:absolute; inset:-30%; z-index:0; pointer-events:none;
    -webkit-mask-image: radial-gradient(circle at 50% 50%, rgba(0,0,0,1) 62%, rgba(0,0,0,0) 100%);
            mask-image: radial-gradient(circle at 50% 50%, rgba(0,0,0,1) 62%, rgba(0,0,0,0) 100%);
  }
  .fog{
    position:absolute; inset:0; mix-blend-mode:screen; filter: blur(60px) saturate(120%);
    background:
      radial-gradient(28% 22% at 20% 30%, var(--nick) 0 55%, transparent 60%),
      radial-gradient(28% 24% at 80% 40%, var(--nick) 0 55%, transparent 60%),
      radial-gradient(30% 22% at 40% 70%, var(--nick) 0 55%, transparent 60%);
    animation:fog1 26s linear infinite alternate; opacity:.62;
  }
  @keyframes fog1{ 0%{transform:translate(0,0) scale(1)} 100%{transform:translate(-3%,-4%) scale(1.08)} }

  #focus{ position:absolute; inset:0; display:grid; place-items:center; z-index:2 }

  .wrapCenter{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); }
  .spin{ position:absolute; inset:0; }

  /* soft per-object halo */
  .halo{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    border-radius:50%; background:radial-gradient(closest-side, rgba(0,0,0,.38), rgba(0,0,0,0));
    filter: blur(10px); pointer-events:none; z-index:-1;
  }

  /* Center bubble (no border) */
  #question{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%) scale(.9);
    display:grid; place-items:center; background:#000; color:#fff; border-radius:50%;
    border:none; z-index:5; filter:drop-shadow(var(--scene-glow));
    padding:.4rem .6rem; cursor:pointer;
  }
  #questionText{
    font-weight:900; font-style:italic; text-align:center;
    font-size:clamp(16px,3.6vw,22px); line-height:1.15; margin:0;
  }

  /* INNER ring (z=2): CW; transparent gaps; NO borders */
  #innerWrap{ z-index:2; } /* size set by JS */
  #innerSpin{ animation:spinCW 60s linear infinite; filter:drop-shadow(var(--scene-glow)) }
  @keyframes spinCW{ from{ transform: rotate(0deg) } to{ transform: rotate(360deg) } }
  #innerSurface{
    position:absolute; inset:0; border-radius:50%;
    -webkit-mask: radial-gradient(circle,
      transparent calc(50% - var(--inner-thick)),
      #000       calc(50% - var(--inner-thick)),
      #000       calc(50% + var(--inner-thick)),
      transparent calc(50% + var(--inner-thick)));
            mask: radial-gradient(circle,
      transparent calc(50% - var(--inner-thick)),
      #000       calc(50% - var(--inner-thick)),
      #000       calc(50% + var(--inner-thick)),
      transparent calc(50% + var(--inner-thick)));
  }

  /* COMET lane (z=2.5) ‚Äî between inner & outer rings */
  #cometField{ z-index:2.5; }  /* sized by JS; animated in JS */
  .comet{
    position:absolute; left:50%; top:50%; pointer-events:none;
    filter: drop-shadow(0 0 12px #000) drop-shadow(0 0 20px #000);
    opacity:.95;
  }
  .cometStack{ display:flex; flex-direction:column; align-items:center; line-height:1; font-size:clamp(18px, 4.4vw, 26px); }
  .cometStack .top{ margin-bottom:-2px; } /* üü† sits close to ‚òÑÔ∏è */

  /* OUTER ring (z=3): CW; transparent gaps; NO borders */
  #outerWrap{ z-index:3; } /* size set by JS */
  #outerSpin{ animation:spinCW 70s linear infinite }
  #outerSurface{ position:absolute; inset:0; border-radius:50% }

  /* Emoji rings (z=4) CCW, evenly spaced, staggered; NO emoji borders */
  #emojiWrapA, #emojiWrapB { z-index:4; } /* size set by JS; both centered */
  .emojiRing{ position:absolute; inset:0 }
  .emojiSpin{ position:absolute; inset:0; animation:spinCCW var(--dur,60s) linear infinite; }
  @keyframes spinCCW{ from{ transform: rotate(0deg) } to{ transform: rotate(-360deg) } }
  .emoji{
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    font-size: var(--emoji-font); line-height:1;
    border:none; border-radius:10px; background:rgba(0,0,0,.08);
    padding:1px 3px; filter: drop-shadow(0 0 8px #000) drop-shadow(0 0 14px #000); cursor:pointer;
  }

  /* MID painting nodes (z=8 TOPMOST) with halo + THIN border */
  #midWrap{ z-index:8; } /* paintings on top of everything (except outro) */
  #midSpin{ animation:spinCCW 56s linear infinite; filter:drop-shadow(var(--scene-glow)) }
  #midRing{ position:absolute; inset:0 }
  .mnode{
    position:absolute; top:50%; left:50%; border-radius:50%;
    transform:translate(-50%,-50%); background:#111; overflow:hidden;
    border:1.5px solid #000;            /* thinner border */
    filter:drop-shadow(var(--scene-glow)); cursor:pointer;
  }
  .mnode.withCloud::before{
    content:""; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:calc(100% + 16px); height:calc(100% + 16px); border-radius:inherit;
    background:radial-gradient(closest-side, rgba(0,0,0,.38), rgba(0,0,0,0)); filter:blur(8px); pointer-events:none;
  }
  .mnode img{
    width:100%; height:100%; object-fit:cover; display:block; border-radius:50%;
    animation: keepUpright 56s linear infinite; transform-origin:center; backface-visibility:hidden; will-change: transform;
  }
  @keyframes keepUpright{ from{ transform: rotate(0deg) } to{ transform: rotate(360deg) } }
  .mnode.noimg{ background: radial-gradient(60% 54% at 50% 42%, #444 0%, #222 60%, #000 100%) }

  /* Outro overlay (z=10) */
  #outro{
    position:fixed; inset:0; background:#000; opacity:0; pointer-events:none; z-index:10;
    display:flex; align-items:center; justify-content:center; transition:opacity 1.2s ease;
  }
  #outro.show{ opacity:1; pointer-events:auto; }
  #quote{
    text-align:center; white-space:pre-line;
    font-weight:900; font-style:italic; letter-spacing:.02em;
    font-size:clamp(18px,5.2vw,30px); line-height:1.25; color:#FFA64D;
    text-shadow: 0 0 10px rgba(0,0,0,.8), 0 0 30px rgba(255,166,77,.25);
    opacity:0; animation: quoteIn 1.2s ease forwards; animation-delay: 1.0s;
  }
  @keyframes quoteIn{ to{ opacity:1; } }
</style>
</head>
<body>
  <div id="phone">
    <div id="canvas">

      <div id="brandBar"><div id="brand">neurOrange</div></div>

      <div id="bgLayer">
        <video id="bgVideo" muted playsinline webkit-playsinline preload="auto"></video>
        <div id="tapToPlay">Tap to play video</div>
        <div class="fogWrap"><div class="fog"></div></div>
      </div>

      <div id="focus">
        <!-- OUTER color ring -->
        <div id="outerWrap" class="wrapCenter">
          <div id="outerSpin" class="spin"><div id="outerSurface" aria-hidden="true"></div></div>
          <div class="halo" id="outerHalo"></div>
        </div>

        <!-- INNER color ring -->
        <div id="innerWrap" class="wrapCenter">
          <div id="innerSpin" class="spin"><div id="innerSurface" aria-hidden="true"></div></div>
          <div class="halo" id="innerHalo"></div>
        </div>

        <!-- COMET FIELD (between inner & outer) -->
        <div id="cometField" class="wrapCenter"></div>

        <!-- MID painting nodes (TOPMOST) -->
        <div id="midWrap" class="wrapCenter">
          <div id="midSpin" class="spin"><div id="midRing" aria-hidden="true"></div></div>
        </div>

        <!-- Emoji ring 4 (CCW) -->
        <div id="emojiWrapA" class="wrapCenter">
          <div class="emojiSpin" style="--dur:56s"><div id="emojiRingA" class="emojiRing"></div></div>
        </div>
        <!-- Emoji ring 5 (CCW, staggered) -->
        <div id="emojiWrapB" class="wrapCenter">
          <div class="emojiSpin" style="--dur:82s; transform: rotate(-12deg)"><div id="emojiRingB" class="emojiRing"></div></div>
        </div>

        <!-- Center text -->
        <div id="question"><div id="questionText">What are you<br/>feeling?</div></div>
      </div>

      <!-- Outro overlay -->
      <div id="outro"><div id="quote">In a world full of yellows and reds
Dare to be orange</div></div>
    </div>
  </div>

<script>
/* ---------- Palettes ---------- */
const ORANGE_LIBRARY={
  ghosts:[{hex:"#B36019"},{hex:"#F9751F"},{hex:"#F6B76F"},{hex:"#D2B379"},{hex:"#E3AC47"},{hex:"#F88E10"},{hex:"#C18514"},{hex:"#DE9513"},{hex:"#92752D"},{hex:"#F0CE85"},{hex:"#FCBA45"},{hex:"#D99621"},{hex:"#E8C569"},{hex:"#F0B85F"},{hex:"#D2B265"}],
  standards:[{hex:"#F4C430"},{hex:"#FFBF00"},{hex:"#FCC200"},{hex:"#F28500"},{hex:"#FD5E53"},{hex:"#E25822"},{hex:"#FFA500"},{hex:"#D99058"},{hex:"#E87D0D"},{hex:"#FF7F24"},{hex:"#C76A1F"},{hex:"#CB6D51"},{hex:"#FF7F50"},{hex:"#FF8E00"},{hex:"#D07A2D"}],
  food:[{hex:"#ED9121"},{hex:"#FBCEB1"},{hex:"#F28500"},{hex:"#FFA64D"},{hex:"#FF7518"},{hex:"#F6A200"},{hex:"#F98B00"},{hex:"#FFA500"},{hex:"#F99E1A"},{hex:"#E67E22"},{hex:"#F6A700"},{hex:"#DE7C00"},{hex:"#E67910"},{hex:"#FF8A00"},{hex:"#EC5800"}]
};
/* Orange-only emojis (non-orange removed) */
const EMOJIS = [
  "&#128992;","&#129031;","&#128246;","&#128248;","&#129505;", /* üü†üüßüî∂üî∏üß° */
  "&#127818;","&#129389;","&#129365;","&#127840;",             /* üçäü•≠ü•ïüç† */
  "&#127875;","&#127936;","&#128217;"                          /* üéÉüèÄüìô */
];

/* ---------- Video ping-pong (forward‚Üîreverse) with tap fallback ---------- */
(function pingPongVideo(){
  const v=document.getElementById('bgVideo'), tap=document.getElementById('tapToPlay');
  v.src = 'assets/placeholder.mp4';
  let dir=1, rafId=null, rafMode=false;
  const fps=60, step=1/fps;
  function cancel(){ if(rafId){ cancelAnimationFrame(rafId); rafId=null; } }
  function stepRAF(){
    v.currentTime = Math.max(0, Math.min(v.duration, v.currentTime + step*dir));
    if(v.currentTime >= v.duration-0.03) dir = -1;
    if(v.currentTime <= 0.03) dir =  1;
    rafId=requestAnimationFrame(stepRAF);
  }
  function tryNeg(){ return new Promise(res=>{
    if(!isFinite(v.duration)||v.duration===0){ res(false); return; }
    const t0=v.currentTime; v.playbackRate=-1;
    setTimeout(()=>res(v.currentTime<t0), 250);
  });}
  function forward(){ cancel(); rafMode=false; v.playbackRate=1; v.play().catch(()=>{}); }
  async function reverse(){ cancel(); const ok=await tryNeg(); if(ok){ rafMode=false; v.playbackRate=-1; v.play().catch(()=>{}); } else { rafMode=true; v.pause(); rafId=requestAnimationFrame(stepRAF); } }
  v.addEventListener('ended', ()=>{ dir=-1; reverse(); });
  v.addEventListener('timeupdate', ()=>{ if(dir<0 && !rafMode && v.currentTime<=0.05){ dir=1; forward(); }});
  v.addEventListener('loadedmetadata', ()=>{ v.currentTime=0.01; dir=1; forward(); });

  function showTap(){ tap.style.display='block'; }
  function hideTap(){ tap.style.display='none'; }
  function tryStart(){ const p=v.play(); if(p && p.catch) p.catch(()=>showTap()); }
  if(document.readyState!=='loading') tryStart(); else document.addEventListener('DOMContentLoaded', tryStart, {once:true});
  document.addEventListener('visibilitychange', ()=>{ if(!document.hidden && v.paused) tryStart(); });
  window.addEventListener('pointerdown', ()=>{ if(v.paused){ hideTap(); tryStart(); } }, {passive:true});
  v.addEventListener('error', ()=>{ hideTap(); });   // keep fog
})();

/* ---------- helpers ---------- */
const gdeg=()=>parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--gap-deg'))||3;
const conicWithGaps=(cols,g,gapColor)=>{const seg=360/cols.length,parts=[];for(let i=0;i<cols.length;i++){const s=i*seg,ce=s+(seg-g),ge=s+seg;parts.push(`${cols[i]} ${s}deg ${ce}deg`,`${gapColor} ${ce}deg ${ge}deg`)}return `conic-gradient(${parts.join(',')})`};
const ghostFirst=n=>{const g=ORANGE_LIBRARY.ghosts.map(x=>x.hex),s=ORANGE_LIBRARY.standards.map(x=>x.hex);const out=g.slice(0,n);let i=0;while(out.length<n)out.push(s[i++%s.length]);return out}
const foodPalette=n=>{const f=ORANGE_LIBRARY.food.map(x=>x.hex);const out=[];let i=0;while(out.length<n)out.push(f[i++%f.length]);return out}

/* ---------- center bubble sizing ---------- */
function sizeQuestion(){
  const b=document.getElementById('question'), t=document.getElementById('questionText');
  const prev=b.style.transform; b.style.transform='translate(-50%,-50%) scale(1)';
  const w=t.offsetWidth, h=t.offsetHeight, pad=Math.max(4,Math.round(Math.max(w,h)*0.02));
  const D=Math.ceil(Math.max(w,h)+pad*2); b.style.width=D+'px'; b.style.height=D+'px';
  b.style.transform=prev||'translate(-50%,-50%) scale(0.90)';
}

/* ---------- paintings loader (robust; cache-buster; case variants) ---------- */
function buildMidNodes(){
  const mid=document.getElementById('midRing'); mid.innerHTML='';
  const exts=['.jpg','.jpeg','.png','.JPG','.JPEG','.PNG'];
  for(let i=1;i<=6;i++){
    const n=document.createElement('div'); n.className='mnode withCloud';
    const img=new Image(); img.alt='Painting'; n.appendChild(img); mid.appendChild(n);
    let k=0; const stamp='?v='+Date.now();
    (function tryNext(){
      if(k>=exts.length){ n.classList.add('noimg'); return; }
      img.onerror = tryNext; img.decoding='async'; img.loading='eager';
      img.src = `assets/paintings/${i}${exts[k++]}${stamp}`;
    })();
  }
}

/* ---------- geometry for rings (concentric) ---------- */
function layoutRings(){
  const root=document.documentElement, canvas=document.getElementById('canvas');
  const innerWrap=document.getElementById('innerWrap'), innerSurface=document.getElementById('innerSurface');
  const innerHalo=document.getElementById('innerHalo');
  const midWrap=document.getElementById('midWrap'),  midRing=document.getElementById('midRing');
  const outerWrap=document.getElementById('outerWrap'), outerSurface=document.getElementById('outerSurface');
  const outerHalo=document.getElementById('outerHalo');
  const emojiWrapA=document.getElementById('emojiWrapA'), emojiWrapB=document.getElementById('emojiWrapB');

  const W=window.innerWidth, H=window.innerHeight, S=Math.min(W,H);
  canvas.style.width=W+'px'; canvas.style.height=H+'px';
  root.style.setProperty('--emoji-font', Math.round(W*0.036)+'px');

  /* inner ring */
  const innerD=Math.round(S*0.58);
  const innerThick=Math.max(16,Math.round(innerD*0.12));
  innerWrap.style.width=innerWrap.style.height=innerD+'px';
  root.style.setProperty('--inner-thick', innerThick+'px');
  innerSurface.style.background = conicWithGaps(foodPalette(12), gdeg(), 'transparent');
  innerHalo.style.width = innerHalo.style.height = (innerD+24)+'px';

  /* mid nodes ‚Äî smaller (shrink), so radius increases (moved outward) */
  midWrap.style.width=midWrap.style.height=innerD+'px';
  const nodeScale=0.82;                                           /* shrink factor */
  const nodeD=Math.round(innerThick*0.85*5.25*nodeScale);         /* smaller nodes */
  const margin=2, midR=Math.max(0,(W/2)-(nodeD/2)-margin);        /* outward radius */
  const nodes=midRing.querySelectorAll('.mnode'); const N=6, step=2*Math.PI/N;
  nodes.forEach((n,i)=>{ const a=i*step, x=Math.cos(a)*midR, y=Math.sin(a)*midR;
    n.style.width=n.style.height=nodeD+'px';
    n.style.transform=`translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`; });

  /* outer ring */
  const outerInnerR = midR + nodeD/2 + margin;
  const outerThick  = innerThick * (parseFloat(getComputedStyle(root).getPropertyValue('--outer-thick-mult'))||2.2);
  const outerOuterR = Math.max(outerInnerR + outerThick, W/2 + 8);
  const outD = Math.round(outerOuterR*2);
  outerWrap.style.width=outerWrap.style.height=outD+'px';
  const mask=`radial-gradient(circle, transparent ${outerInnerR}px, #000 ${outerInnerR}px, #000 ${outerOuterR}px, transparent ${outerOuterR}px)`;
  outerSurface.style.webkitMask=mask; outerSurface.style.mask=mask;
  outerSurface.style.background = conicWithGaps(ghostFirst(18), gdeg(), 'transparent');
  outerHalo.style.width = outerHalo.style.height = (outD+28)+'px';

  /* emoji radii right outside ring3 */
  const gap = Math.max(8, Math.round(S*0.014));
  const rA = outerOuterR + gap;
  const rB = rA + Math.max(22, Math.round(S*0.028));
  emojiWrapA.style.width=emojiWrapA.style.height=(rA*2)+'px';
  emojiWrapB.style.width=emojiWrapB.style.height=(rB*2)+'px';

  // build static positions for emojis (evenly spaced); wrapper spins CCW
  buildEmojiRings(rA, rB);

  // store comet geometry
  window.__geom = { W, H, S, innerD, innerThick, midR, nodeD, outerInnerR, outerOuterR, rA, rB };
}

/* ---------- emoji rings: evenly spaced, CCW via wrapper rotation (NO sinusoid) ---------- */
function buildEmojiRings(rA, rB){
  const ringA=document.getElementById('emojiRingA');
  const ringB=document.getElementById('emojiRingB');
  ringA.innerHTML=''; ringB.innerHTML='';

  const rep=2;                           /* repeat set for density */
  const listA=Array.from({length:rep}).flatMap(()=>EMOJIS);
  const listB=Array.from({length:rep}).flatMap(()=>EMOJIS);

  function place(ringEl, list, R, phase=0){
    const n = list.length;
    for(let i=0;i<n;i++){
      const d=document.createElement('div'); d.className='emoji'; d.innerHTML=`<span>${list[i]}</span>`;
      const a = i*(2*Math.PI/n) + phase;   // even spacing + optional offset
      const x = Math.cos(a)*R, y=Math.sin(a)*R;
      d.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
      ringEl.appendChild(d);
    }
  }
  place(ringA, listA, rA, 0);                             // ring 4
  place(ringB, listB, rB, Math.PI*2/(listB.length*2));    // ring 5 staggered (half-slot)
}

/* ---------- comet spawner (slower; random straight/offcenter/curved) ---------- */
(function cometSpawner(){
  const field = document.getElementById('cometField');

  function spawnOnce(){
    const g = window.__geom;
    if(!g){ setTimeout(spawnOnce, 800); return; }

    // Choose path type
    const kinds = ['straight','offcenter','curved'];
    const kind = kinds[Math.floor(Math.random()*kinds.length)];

    const center = {x:0, y:0}; // since field is centered with translate(-50%,-50%)
    const baseR = (g.outerInnerR + (g.innerD/2 + g.innerThick)) / 2; // between inner-outer rings

    // pick direction
    const theta = Math.random()*Math.PI*2;
    const n = {x: -Math.sin(theta), y: Math.cos(theta)};  // normal

    // chord length further than screen to ensure full cross
    const run = Math.max(g.W, g.H) + 400;
    const dur = 4.8 + Math.random()*3.0;   // slower: 4.8‚Äì7.8s

    // path points in field coords (centered)
    let P0, P1, C; // quadratic control for curved

    if(kind==='straight'){
      P0 = {x: center.x - Math.cos(theta)*run/2, y: center.y - Math.sin(theta)*run/2};
      P1 = {x: center.x + Math.cos(theta)*run/2, y: center.y + Math.sin(theta)*run/2};
    } else if(kind==='offcenter'){
      const offset = (g.rA + g.rB)/2 - baseR; // slight lane bias
      const d = (Math.random()*0.35 + 0.15) * baseR; // 15‚Äì50% of lane radius
      const shift = {x: n.x * (Math.random()<0.5?-d:d), y: n.y * (Math.random()<0.5?-d:d)};
      P0 = {x: center.x - Math.cos(theta)*run/2 + shift.x, y: center.y - Math.sin(theta)*run/2 + shift.y};
      P1 = {x: center.x + Math.cos(theta)*run/2 + shift.x, y: center.y + Math.sin(theta)*run/2 + shift.y};
    } else { // curved (quadratic bezier)
      P0 = {x: center.x - Math.cos(theta)*run/2, y: center.y - Math.sin(theta)*run/2};
      P1 = {x: center.x + Math.cos(theta)*run/2, y: center.y + Math.sin(theta)*run/2};
      const bend = (Math.random()*0.5 + 0.3) * baseR;  // curvature amount
      C  = {x: center.x + n.x * (Math.random()<0.5?-bend:bend),
            y: center.y + n.y * (Math.random()<0.5?-bend:bend)};
    }

    // element
    const comet = document.createElement('div');
    comet.className = 'comet';
    const stack = document.createElement('div');
    stack.className = 'cometStack';
    const top = document.createElement('div'); top.className='top'; top.innerHTML='&#128992;';   // üü†
    const tail= document.createElement('div'); tail.innerHTML='&#x2604;&#xFE0F;';                // ‚òÑÔ∏è
    stack.appendChild(top); stack.appendChild(tail);
    comet.appendChild(stack);
    field.appendChild(comet);

    let t0=null;
    function lerp(a,b,t){ return a + (b-a)*t; }
    function draw(now){
      if(!t0) t0=now;
      let u = Math.min(1, (now-t0)/(dur*1000));
      let x,y;
      if(kind==='curved' && C){
        // Quadratic Bezier
        const x0=P0.x, y0=P0.y, x1=C.x, y1=C.y, x2=P1.x, y2=P1.y;
        const one=1-u;
        x = one*one*x0 + 2*one*u*x1 + u*u*x2;
        y = one*one*y0 + 2*one*u*y1 + u*u*y2;
      }else{
        x = lerp(P0.x, P1.x, u);
        y = lerp(P0.y, P1.y, u);
      }
      comet.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
      if(u<1){ requestAnimationFrame(draw); } else { comet.remove(); }
    }
    requestAnimationFrame(draw);
  }

  function loop(){
    spawnOnce();
    const next = 7000 + Math.random()*5000; // every 7‚Äì12s
    setTimeout(loop, next);
  }
  setTimeout(loop, 1200);
})();

/* ---------- outro: fade-to-black + quote on ANY object tap ---------- */
function installOutroTriggers(){
  const selectors = [
    '#innerSurface', '#outerSurface',
    '.mnode', '.emoji',
    '#question', '#brand'
  ].join(',');

  function trigger(){
    const outro=document.getElementById('outro');
    if(outro.classList.contains('show')) return;
    outro.classList.add('show');
  }
  document.querySelectorAll(selectors).forEach(el=>{
    el.addEventListener('pointerdown', trigger, {once:true});
    el.addEventListener('touchstart', trigger, {once:true, passive:true});
  });
}

/* ---------- boot ---------- */
function boot(){
  sizeQuestion();
  buildMidNodes();
  layoutRings();
  installOutroTriggers();
}
boot();
window.addEventListener('resize', boot);
</script>
</body>
</html>